(()=>{"use strict";const e=document.querySelector("#trello"),t=new class{constructor(e){this.page=e,this.dragEl=null,this.dragCloneEl=null,this.dragElHeight=null,this.startPosX=null,this.startPosY=null}init(){this.page.querySelectorAll(".block").forEach((e=>{e.addEventListener("click",this.blockClick.bind(this)),e.addEventListener("mouseleave",this.constructor.mouseLeave),e.querySelector(".block-items").addEventListener("mousedown",this.mouseDown.bind(this))})),this.page.addEventListener("mousemove",this.mouseMove.bind(this)),this.page.addEventListener("mouseup",this.mouseUp.bind(this))}static mouseLeave(e){e.preventDefault();const t=e.target.querySelector(".prev-item");t&&t.remove()}mouseDown(e){if(e.preventDefault(),"P"!==e.target.tagName)return;this.dragEl=e.target;const{top:t,left:s,height:r}=this.dragEl.getBoundingClientRect();this.dragElHeight=r,this.dragCloneEl=this.dragEl.cloneNode(!0),this.dragCloneEl.classList.add("draggable"),this.startPosY=e.pageY-t,this.startPosX=e.pageX-s,this.dragCloneEl.style.top=`${window.scrollY+t}px`,this.dragCloneEl.style.left=`${window.scrollX+s}px`,this.dragEl.style.display="none",document.body.appendChild(this.dragCloneEl)}mouseMove(e){if(e.preventDefault(),!this.dragEl)return;this.dragCloneEl.style.top=window.scrollY+e.pageY-this.startPosY+"px",this.dragCloneEl.style.left=window.scrollX+e.pageX-this.startPosX+"px";const t=document.elementFromPoint(e.pageX,e.pageY);if("P"===t.tagName){const{top:s,height:r}=t.getBoundingClientRect();if(e.pageY<s+r/2){const e=t.previousElementSibling;if(e&&e.classList.contains("prev-item"))return;this.removePrevItem();const s=this.constructor.createGhost(this.dragElHeight);t.before(s)}if(e.pageY>=s+r/2){const e=t.nextElementSibling;if(e&&e.classList.contains("prev-item"))return;this.removePrevItem();const s=this.constructor.createGhost(this.dragElHeight);t.after(s)}}if(t.closest(".block")){if(this.page.querySelector(".prev-item"))return;const e=this.constructor.createGhost(this.dragElHeight);t.closest(".block").querySelector(".block-items").append(e)}t.classList.contains("trello")&&this.removePrevItem()}mouseUp(e){if(e.preventDefault(),!this.dragEl)return;if(e.target.classList.contains("trello"))return document.body.removeChild(this.dragCloneEl),this.dragEl.style.display="block",this.dragEl.classList.remove("draggable"),this.dragEl=null,void(this.dragCloneEl=null);const t=this.page.querySelector(".prev-item");t&&t.replaceWith(this.dragEl),this.dragEl.style.display="block",document.body.removeChild(this.dragCloneEl),this.dragEl=null,this.dragCloneEl=null}static createGhost(e){const t=document.createElement("div");return t.classList.add("prev-item"),t.style.height=`${e}px`,t}removePrevItem(){const e=this.page.querySelector(".prev-item");e&&e.remove()}blockClick(e){e.preventDefault();const t=e.target;if(t.classList.contains("block-item-remove")&&t.closest(".block-item").remove(),"create"===t.dataset.addButton){const e=this.page.querySelector(".block-add");e&&(e.remove(),this.page.querySelector(".hidden").classList.remove("hidden")),t.before(this.constructor.addFormToElement()),t.classList.add("hidden")}if("add"===t.dataset.addButton){const t=e.currentTarget.querySelector(".block-add-field").value.trim();if(""===t)return;const s=this.constructor.createCardItem(t);e.currentTarget.querySelector(".block-items").append(s),e.currentTarget.querySelector(".block-add").remove(),e.currentTarget.querySelector('[data-add-button="create"]').classList.remove("hidden")}"close"===t.dataset.addButton&&(e.currentTarget.querySelector(".block-add").remove(),e.currentTarget.querySelector('[data-add-button="create"]').classList.remove("hidden"))}static addFormToElement(){const e=document.createElement("div");e.classList.add("block-add");const t=document.createElement("textArea");t.classList.add("block-add-field"),t.setAttribute("rows",3),t.setAttribute("placeholder","Insert name of the card");const s=document.createElement("div");s.classList.add("block-add-buttons");const r=document.createElement("button");r.classList.add("block-add-button"),r.dataset.addButton="add",r.textContent="Add";const o=document.createElement("button");return o.classList.add("block-add-button"),o.dataset.addButton="close",o.textContent="Close",s.append(r),s.append(o),e.append(t),e.append(s),e}static createCardItem(e){const t=document.createElement("p");t.classList.add("block-item"),t.textContent=e;const s=document.createElement("span");return s.classList.add("block-item-remove"),t.append(s),t}}(e);t.init()})();